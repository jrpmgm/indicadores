{% extends "base.html" %}

{% block content %}

<!--  Barra moderna de par谩metros + bot贸n Filtros -->
<div class="filters-toolbar d-flex flex-wrap align-items-center justify-content-between mb-3">

    <!-- Par谩metros -->
    <div class="d-flex flex-wrap gap-3 align-items-center">

        <!-- Radios de agrupaci贸n -->
        <div class="d-flex flex-wrap gap-3" id="agrouptype_div">
            {% for grouptype in groupingtype %}
                <div class="form-check me-2">
                    <input class="form-check-input"
                           type="radio"
                           name="agrouptype"
                           id="agrouptype_{{ forloop.counter }}"
                           value="{{ grouptype }}"
                           {% if forloop.first %}checked{% endif %}
                           onchange="__onGroupTypeChange__(this, 'GROUP')">
                    <label class="form-check-label" for="agrouptype_{{ forloop.counter }}">
                        {{ grouptype }}
                    </label>
                </div>
            {% endfor %}
        </div>

        <!-- Select de tipo documento -->
        <select class="form-select" id="typedocument" onchange="__onGroupTypeChange__(this, 'DOCUMENT')">
            {% for code, label in typedocuments %}
                <option value="{{ code }}">{{ label }}</option>
            {% endfor %}
        </select>

    </div>

    <!-- Bot贸n FILTROS -->
    <button class="btn btn-primary d-flex align-items-center gap-2"
            data-bs-toggle="modal"
            data-bs-target="#filtersModal">
        <i class="bi bi-funnel"></i> Filtros
    </button>

</div>

<!--  Modal de filtros -->
{% include "partials/filtros_modal.html" %}

<!--  Contenido din谩mico -->
<div id="main-filter-content">
    {% block filter_content %}{% endblock %}
</div>

<!-- ---------------------------------------------------------------
      Wrapper JS para que cada template hijo defina su l贸gica
---------------------------------------------------------------- -->
<script>
    function __onGroupTypeChange__(el, indicator) {
        if (window.__customGroupTypeChange__) {
            if (indicator === 'DOCUMENT') {
                glb_typedocument =  el.value;
            } else {
                glb_grouptype = el.value;
            }
            window.__customGroupTypeChange__(el, indicator);
        }
    }
</script>

{% block on_change_group_type %}
<script>
    // Por defecto no hacer nada
    window.__customGroupTypeChange__ = function(){};
</script>
{% endblock %}

<!-- ---------------------------------------------------------------
      Evento global para filtros (ya existente)
---------------------------------------------------------------- -->
<script>
    document.addEventListener("filters:apply", function (event) {
        const filters = event.detail;
        console.log(" Filtros aplicados (capturados en basefilter):", filters);

        // Reenv铆a evento hacia la plantilla hija
        document.dispatchEvent(new CustomEvent("filters:ready", { detail: filters }));
    });
</script>

{% endblock %}