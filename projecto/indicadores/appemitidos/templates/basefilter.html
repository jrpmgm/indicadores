{% extends "base.html" %}

{% block content %}
<div class="page-title-section dashboard-title-container {% block page_title_container_classes %}{% endblock %}">

    {% block page_title_icon %}
    <!-- Icono por defecto, puede ser reemplazado -->
    <i class="bi bi-speedometer2 dashboard-title-icon"></i>
    {% endblock %}

    <div>
        <h2 class="dashboard-title {% block page_title_classes %}{% endblock %}">
            {% block page_title %}
                T칤tulo por defecto
            {% endblock %}
        </h2>

        {% block page_subtitle %}
        <!-- vacio por defecto -->
        {% endblock %}
    </div>

</div>

    <!-- 游댯 Barra moderna de par치metros + bot칩n Filtros -->
 <div class="filters-toolbar d-flex flex-wrap align-items-center justify-content-between mb-3">
    
    <!-- Par치metros -->
    <div class="d-flex flex-wrap gap-3 align-items-center">

        <!-- Radios de agrupaci칩n -->
        <div class="d-flex flex-wrap gap-3" id="agrouptype_div">
            {% for grouptype in groupingtype %}
                <div class="form-check me-2">
                    <input class="form-check-input"
                           type="radio"
                           name="agrouptype"
                           id="agrouptype_{{ forloop.counter }}"
                           value="{{ grouptype }}"
                           {% if forloop.first %}checked{% endif %}
                           onchange="__onGroupTypeChange__(this, 'GROUP')">
                    <label class="form-check-label" for="agrouptype_{{ forloop.counter }}">
                        {{ grouptype }}
                    </label>
                </div>
            {% endfor %}
        </div>

        <!-- Select de tipo documento -->
        <select class="form-select" id="typedocument" onchange="__onGroupTypeChange__(this, 'DOCUMENT')">
            {% for code, label in typedocuments %}
                <option value="{{ code }}">{{ label }}</option>
            {% endfor %}
        </select>

    </div>

    <!-- Bot칩n FILTROS -->
    <button class="btn btn-primary d-flex align-items-center gap-2"
            data-bs-toggle="modal"
            data-bs-target="#filtersModal">
        <i class="bi bi-funnel"></i> Filtros
    </button>

</div>

<!-- 游댯 Modal de filtros -->
{% include "partials/filtros_modal.html" %}

<!-- 游댯 Contenido din치mico -->
<div id="main-filter-content">
    {% block filter_content %}{% endblock %}
</div>

<!-- ---------------------------------------------------------------
     游댯 Wrapper JS para que cada template hijo defina su l칩gica
---------------------------------------------------------------- -->
<script>
    function __onGroupTypeChange__(el, indicator) {
        if (window.__customGroupTypeChange__) {
            if (indicator === 'DOCUMENT') {
                glb_typedocument =  el.value;
            } else {
                glb_grouptype = el.value;
            }
            window.__customGroupTypeChange__(el, indicator);
        }
    }
</script>

{% block on_change_group_type %}
<script>
    // Por defecto no hacer nada
    window.__customGroupTypeChange__ = function(){};
</script>
{% endblock %}

<!-- ---------------------------------------------------------------
     游댯 Evento global para filtros (ya existente)
---------------------------------------------------------------- -->
<script>
    document.addEventListener("filters:apply", function (event) {
        const filters = event.detail;
        console.log("游닍 Filtros aplicados (capturados en basefilter):", filters);

        // Reenv칤a evento hacia la plantilla hija
        document.dispatchEvent(new CustomEvent("filters:ready", { detail: filters }));
    });
</script>

{% endblock %}