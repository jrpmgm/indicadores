{% extends "basewithoutfilter.html" %}

{% load static %}

{% block page_title %}Ventas por Periodos{% endblock %}
{% block page_title_icon %}
<i class="bi bi-bar-chart-line-fill dashboard-title-icon text-primary"></i>
{% endblock %}
{% block page_subtitle %}
<div class="dashboard-subtitle">Análisis Gerencial por Filtros</div>
{% endblock %}

{% block filter_content %}

<div class="card p-3 shadow-sm mb-3">

    <div class="row g-2">
        <div class="col-md-2">
            <label>Fecha Desde</label>
            <input type="date" id="filterDateFrom" class="form-control">
        </div>
        <div class="col-md-2">
            <label>Fecha Hasta</label>
            <input type="date" id="filterDateTo" class="form-control">
        </div>

        <div class="col-md-2">
            <label>Tipo Documento</label>
            <select id="filterTypeDocument" class="form-select">
                <option value="ALL">Todos</option>
                <option value="FAC">Facturas</option>
                <option value="NC">Notas de Crédito</option>
            </select>
        </div>

        <div class="col-md-3">
            <label>Partner</label>
            <select id="filterPartner" class="form-select">
                <option value="ALL">Todos</option>
            </select>
        </div>

        <div class="col-md-3 d-flex align-items-end">
            <button id="btnApplyFilters" class="btn btn-primary w-100">
                Aplicar Filtros
            </button>
        </div>
    </div>

    <hr>

    <div style="overflow-x: auto; white-space: nowrap; padding-bottom: 10px;">
        <div class="d-inline-flex flex-row g-2 align-items-end" style="width: 100%;">
            
            <div class="p-1" style="flex: 0 0 14.28%;">
                <label>Continente</label>
                <select id="filterLevel1" class="form-select"></select>
            </div>
            <div class="p-1" style="flex: 0 0 14.28%;">
                <label>País</label>
                <select id="filterLevel2" class="form-select"></select>
            </div>
            <div class="p-1" style="flex: 0 0 14.28%;">
                <label>Región</label>
                <select id="filterLevel3" class="form-select"></select>
            </div>
            <div class="p-1" style="flex: 0 0 14.28%;">
                <label>Provincia</label>
                <select id="filterLevel4" class="form-select"></select>
            </div>
            <div class="p-1" style="flex: 0 0 14.28%;">
                <label>Ciudad</label>
                <select id="filterLevel5" class="form-select"></select>
            </div>
            <div class="p-1" style="flex: 0 0 14.28%;">
                <label>Establecimiento</label>
                <select id="filterLevel6" class="form-select"></select>
            </div>
            <div class="p-1" style="flex: 0 0 14.28%;">
                <label>Punto</label>
                <select id="filterLevel7" class="form-select"></select>
            </div>
        </div>
    </div>
</div>

<div class="row text-center mb-4" id="dashboard-kpis">
    {% comment %} Spinners generados vía JS {% endcomment %}
    <div class="col-md-3"><div class="card bg-primary text-white shadow-sm">
        <div class="card-body"><h6>Total Ventas</h6><h3 class="kpi-value" id="kpiTotalVentas"></h3></div></div>
    </div>
    <div class="col-md-3"><div class="card bg-success text-white shadow-sm">
        <div class="card-body"><h6># Facturas</h6><h3 class="kpi-value" id="kpiFacturas"></h3></div></div>
    </div>
    <div class="col-md-3"><div class="card bg-danger text-white shadow-sm">
        <div class="card-body"><h6># Notas Crédito</h6><h3 class="kpi-value" id="kpiNotas"></h3></div></div>
    </div>
    <div class="col-md-3"><div class="card bg-info text-white shadow-sm">
        <div class="card-body"><h6>Partners Activos</h6><h3 class="kpi-value" id="kpiPartners"></h3></div></div>
    </div>
</div>

<div class="row">
    <div class="col-md-6 mb-4">
        <div class="chart-wrapper">
            <canvas id="chartVentasMes"></canvas>
        </div>
    </div>

    <div class="col-md-6 mb-4">
        <div class="row h-100">
            <div class="col-7">
                <div class="chart-wrapper">
                    <canvas id="chartTopPartners"></canvas>
                </div>
            </div>
            <div class="col-5 d-flex align-items-center">
                <div class="container">
                    <ul id="chartTopPartnersLegend" class="list-unstyled mb-0"></ul>
                    <button id="btnShowAllPartners" class="btn btn-sm btn-outline-secondary mb-2 w-100"> Mostrar todo </button>
                </div>
            </div>
        </div>
    </div>
</div>

<table id="salesTable" class="table table-striped table-bordered shadow-sm text-center align-middle" width="100%">
    <thead class="table-primary">
        <tr>
            <th>Fecha</th>
            <th>Identificación</th>
            <th>Partner</th>
            <th>Factura</th>
            <th>Estab.</th>
            <th>Subtotal</th>
            <th>Iva</th>
            <th>Total</th>
        </tr>
    </thead>
    <tbody></tbody>
    <tfoot>
        <tr><th colspan="7" class="text-end">TOTAL</th><th id="footer_total">$0.00</th></tr>
    </tfoot>
</table>

{% endblock %}

{% block extra_js %}
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="{% static 'js/salesDB.js' %}"></script>
{% endblock %}